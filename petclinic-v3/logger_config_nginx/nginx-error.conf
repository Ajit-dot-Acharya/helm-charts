<source>
	pos_file /tmp/nginx_error.pos
	path /var/log/nginx/error1.log
	tag "#{ENV['DEEPINSIGHT_PROJECT_NAME']}.#{ENV['DEEPINSIGHT_APPLICATION_NAME']}.logger.nginx-error"
	@type tail
	format nginx
	<parse>
		@type none
	</parse>
</source>

<filter **.logger.nginx-error>
	@type parser
	key_name message
	<parse>
		time_format %Y/%m/%d %H:%M:%S
		expression (?<time>[^ ]* [^ ]*)\s*\[(?<level>\S+)\]\s*(?<pid>\d+)#(?<tid>\d+)\:\s*(?<message>.*)$
		@type regexp
	</parse>
</filter>

<filter **.logger.nginx-error>
	enable_ruby
	@type record_transformer
	<record>
		node "#{Socket.gethostname}"
		_documentType "nginxErrorLogs"
		file "${tag_suffix[1]}"
		level "${n_level='error'; if record['level'] == 'emerg' then n_level else record['level'] end}"
		time "${require 'time'; time.to_time.to_i * 1000}"
		_plugin "nginx"
                _tag_podName "#{ENV['POD_NAME']}"
                _nodeName "#{ENV['NODE_NAME']}"
                _tag_appName "#{ENV['DEEPINSIGHT_APPLICATION_NAME']}"		
                _tag_projectName "#{ENV['DEEPINSIGHT_PROJECT_NAME']}"		
	</record>
</filter>

<filter **.logger.nginx-error>
	@type grep
	regexp1 level (.*(error).*?)
</filter>


